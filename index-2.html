<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Anatom√≠a de Mam√≠feros</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --naranja-vibrante: #db6015;
            --amarillo-dorado: #f7be00;
            --azul-oscuro: #244b5a;
            --rojo-ladrillo: #993921;
            --azul-claro: #f0f8ff;
            --blanco: #ffffff;
            --gris-suave: #f5f5f5;
            --verde-exito: #4caf50;
            --rojo-error: #f44336;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--azul-claro) 0%, #e8f4ff 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .contenedor-principal {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--blanco);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .barra-encabezado {
            background: linear-gradient(90deg, var(--azul-oscuro) 0%, var(--naranja-vibrante) 100%);
            color: var(--blanco);
            padding: 30px;
            text-align: center;
        }

        .barra-encabezado h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .contenido-quiz {
            padding: 40px;
        }

        .seccion-inicio {
            text-align: center;
            display: none;
        }

        .seccion-inicio.activa {
            display: block;
        }

        .emoji-grande {
            font-size: 80px;
            margin: 30px 0;
        }

        .seccion-inicio p {
            color: var(--azul-oscuro);
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .instrucciones {
            background: var(--azul-claro);
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 4px solid var(--naranja-vibrante);
        }

        .boton-principal {
            background: linear-gradient(90deg, var(--naranja-vibrante), var(--amarillo-dorado));
            color: var(--blanco);
            border: none;
            padding: 15px 50px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .boton-principal:hover {
            transform: scale(1.05);
        }

        .seccion-datos {
            display: none;
        }

        .seccion-datos.activa {
            display: block;
        }

        .form-grupo {
            margin-bottom: 20px;
        }

        .form-grupo label {
            display: block;
            color: var(--azul-oscuro);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-grupo input,
        .form-grupo select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--amarillo-dorado);
            border-radius: 8px;
            font-size: 16px;
        }

        .seccion-actividad {
            display: none;
        }

        .seccion-actividad.activa {
            display: block;
        }

        .encabezado-actividad {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--amarillo-dorado);
        }

        .encabezado-actividad h2 {
            color: var(--naranja-vibrante);
            font-size: 24px;
            flex: 1;
        }

        .indicador-progreso {
            background: var(--amarillo-dorado);
            color: var(--azul-oscuro);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
        }

        /* ACTIVIDAD 1 - PARES */
        .contenedor-pares {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .columna-pares h3 {
            color: var(--naranja-vibrante);
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .lista-pares {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .item-par {
            background: linear-gradient(135deg, var(--azul-claro), #e8f4ff);
            border: 2px solid var(--amarillo-dorado);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--azul-oscuro);
            text-align: center;
            font-size: 14px;
        }

        .item-par:hover {
            background: var(--amarillo-dorado);
            transform: translateY(-3px);
        }

        .item-par.seleccionado {
            background: var(--naranja-vibrante);
            color: var(--blanco);
        }

        .item-par.correcto {
            background: rgba(76, 175, 80, 0.2);
            border-color: var(--verde-exito);
            color: #2e7d32;
            cursor: default;
        }

        /* ACTIVIDAD 2 - ORDENAR CON SELECTS */
        .contenedor-orden-selects {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }

        .item-select-orden {
            background: var(--gris-suave);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--naranja-vibrante);
        }

        .item-select-orden label {
            display: block;
            color: var(--azul-oscuro);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .item-select-orden select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--amarillo-dorado);
            border-radius: 8px;
            font-size: 15px;
            color: var(--azul-oscuro);
            cursor: pointer;
            background-color: var(--blanco);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 40px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }

        .item-select-orden select:hover {
            background-color: var(--azul-claro);
        }

        /* ACTIVIDAD 2 - ORDENAR CON SELECTS */
        .contenedor-drag-orden {
            display: none;
        }

        /* ACTIVIDAD 3 - CLASIFICAR CON BOTONES */
        .contenedor-clasificacion {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .item-clasificacion {
            background: var(--gris-suave);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--naranja-vibrante);
        }

        .nombre-estructura {
            color: var(--azul-oscuro);
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--blanco);
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--amarillo-dorado);
        }

        .botones-clasificacion {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .boton-clasificar {
            padding: 12px 16px;
            border: 2px solid var(--amarillo-dorado);
            background: var(--blanco);
            color: var(--azul-oscuro);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .boton-clasificar:hover {
            background: var(--azul-claro);
            transform: translateY(-2px);
        }

        .boton-clasificar.seleccionado {
            background: var(--naranja-vibrante);
            color: var(--blanco);
            border-color: var(--naranja-vibrante);
        }

        .boton-clasificar.correcto {
            background: rgba(76, 175, 80, 0.2);
            border-color: var(--verde-exito);
            color: #2e7d32;
        }

        .boton-clasificar.incorrecto {
            background: rgba(244, 67, 54, 0.2);
            border-color: var(--rojo-error);
            color: #c62828;
        }

        /* ACTIVIDAD 3 - OCULTAR ZONAS DROP ANTIGUAS */
        .zona-drop-container {
            display: none;
        }

        .items-clasificar-pool {
            display: none;
        }

        /* ACTIVIDAD 4 - PREGUNTAS */
        .pregunta-completa {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--gris-suave);
            border-radius: 8px;
        }

        .pregunta-texto {
            color: var(--azul-oscuro);
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .contenedor-seleccion {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .opcion-seleccion {
            background: var(--blanco);
            border: 2px solid var(--amarillo-dorado);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: var(--azul-oscuro);
            font-weight: 500;
        }

        .opcion-seleccion:hover {
            background: var(--azul-claro);
            transform: translateY(-3px);
        }

        .opcion-seleccion.seleccionada {
            background: var(--naranja-vibrante);
            color: var(--blanco);
            border-color: var(--naranja-vibrante);
        }

        .opcion-seleccion.correcta {
            background: rgba(76, 175, 80, 0.2);
            border-color: var(--verde-exito);
        }

        /* BOTONES */
        .contenedor-botones {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .boton-verificar {
            background: linear-gradient(90deg, var(--naranja-vibrante), var(--amarillo-dorado));
            color: var(--blanco);
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .boton-verificar:hover {
            transform: scale(1.05);
        }

        .boton-reintentar {
            background: linear-gradient(90deg, #ff9800, #ffb74d);
            color: var(--blanco);
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .boton-reintentar.mostrar {
            display: inline-block;
        }

        /* RETROALIMENTACI√ìN */
        .retroalimentacion {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .retroalimentacion.mostrar {
            display: block;
        }

        .retroalimentacion.correcto {
            background: rgba(76, 175, 80, 0.2);
            color: #2e7d32;
            border: 2px solid var(--verde-exito);
        }

        .retroalimentacion.incorrecto {
            background: rgba(244, 67, 54, 0.2);
            color: #c62828;
            border: 2px solid var(--rojo-error);
        }

        /* RESULTADO FINAL */
        .seccion-resultado {
            display: none;
            text-align: center;
        }

        .seccion-resultado.activa {
            display: block;
        }

        .tarjeta-resultado {
            background: linear-gradient(135deg, var(--azul-oscuro), var(--naranja-vibrante));
            color: var(--blanco);
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .emoji-resultado {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .tarjeta-resultado h2 {
            font-size: 32px;
            margin-bottom: 20px;
        }

        .puntuacion-final {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .detalles-resultado {
            background: var(--gris-suave);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .detalle-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--amarillo-dorado);
            color: var(--azul-oscuro);
        }

        .boton-descargar {
            background: linear-gradient(90deg, var(--verde-exito), #81c784);
            color: var(--blanco);
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .boton-descargar:hover {
            transform: scale(1.05);
        }

        .boton-mejorar {
            background: linear-gradient(90deg, #2196F3, #64B5F6);
            color: var(--blanco);
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .boton-mejorar:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="contenedor-principal">
        <div class="barra-encabezado">
            <h1>üìö Quiz: Anatom√≠a de Mam√≠feros</h1>
            <p>Demuestra lo que aprendiste sobre los sistemas del cuerpo</p>
        </div>

        <div class="contenido-quiz">
            <!-- SECCI√ìN INICIO -->
            <div class="seccion-inicio activa" id="seccion-inicio">
                <div class="emoji-grande">ü¶Å</div>
                <h2>¬°Bienvenido al Quiz!</h2>
                <p>Este quiz tiene 4 actividades diferentes para probar tu conocimiento sobre la anatom√≠a de los mam√≠feros.</p>
                <div class="instrucciones">
                    <h3>üìã Instrucciones:</h3>
                    <ul style="text-align: left; padding-left: 20px;">
                        <li>‚úì Lee cada actividad cuidadosamente</li>
                        <li>‚úì Tienes la opci√≥n de reintentar si te equivocas</li>
                        <li>‚úì Al final podr√°s descargar tu reporte en PDF</li>
                        <li>‚úì ¬°Buena suerte! üçÄ</li>
                    </ul>
                </div>
                <button class="boton-principal" onclick="irAlQuiz()">Comenzar Quiz ‚Üí</button>
            </div>

            <!-- SECCI√ìN DATOS ESTUDIANTE -->
            <div class="seccion-datos" id="seccion-datos">
                <h2 style="color: var(--azul-oscuro); margin-bottom: 30px;">üë§ Informaci√≥n del Estudiante</h2>
                
                <div class="form-grupo">
                    <label>Nombre completo:</label>
                    <input type="text" id="nombre-estudiante" placeholder="Tu nombre aqu√≠">
                </div>

                <div class="form-grupo">
                    <label>Grado:</label>
                    <select id="grado-estudiante">
                        <option>4to Primaria</option>
                        <option>5to Primaria</option>
                        <option>6to Primaria</option>
                    </select>
                </div>

                <div class="form-grupo">
                    <label>Fecha:</label>
                    <input type="date" id="fecha-quiz">
                </div>

                <button class="boton-principal" onclick="iniciarActividades()">Comenzar Actividades ‚Üí</button>
            </div>

            <!-- ACTIVIDAD 1: RELACIONAR PARES -->
            <div class="seccion-actividad" id="actividad-1">
                <div class="encabezado-actividad">
                    <h2>üîó Actividad 1: Relaciona Sistemas con Funciones</h2>
                    <span class="indicador-progreso">Actividad 1 de 4</span>
                </div>

                <p style="color: var(--azul-oscuro); margin-bottom: 20px; font-size: 16px;">
                    <strong>‚ö†Ô∏è DESAF√çO:</strong> Haz clic en un sistema y luego en su funci√≥n correspondiente. Ambos deben estar correos para cambiar de color.
                </p>

                <div class="contenedor-pares">
                    <div class="columna-pares">
                        <h3>üîµ Sistemas del Cuerpo</h3>
                        <div class="lista-pares" id="sistemas-desordenados"></div>
                    </div>
                    <div class="columna-pares">
                        <h3>üü† Funciones</h3>
                        <div class="lista-pares" id="funciones-desordenadas"></div>
                    </div>
                </div>

                <div class="retroalimentacion" id="retroalimentacion-act1"></div>
                <div class="contenedor-botones">
                    <button class="boton-verificar" onclick="verificarActividad1()">‚úì Verificar</button>
                    <button class="boton-reintentar" id="btn-reintentar-act1" onclick="reiniciarActividad1()">üîÑ Reintentar</button>
                </div>
            </div>

            <!-- ACTIVIDAD 2: ORDENAR DIGESTI√ìN CON SELECTS -->
            <div class="seccion-actividad" id="actividad-2">
                <div class="encabezado-actividad">
                    <h2>üî¢ Actividad 2: Ordena el Proceso de Digesti√≥n</h2>
                    <span class="indicador-progreso">Actividad 2 de 4</span>
                </div>

                <p style="color: var(--azul-oscuro); margin-bottom: 20px; font-size: 16px;">
                    <strong>‚ö†Ô∏è DESAF√çO:</strong> Selecciona de cada desplegable cu√°l es el paso que corresponde a ese n√∫mero en el proceso digestivo.
                </p>

                <div class="contenedor-orden-selects" id="contenedor-orden-selects">
                    <!-- Se llenar√°n din√°micamente -->
                </div>

                <div class="retroalimentacion" id="retroalimentacion-act2"></div>
                <div class="contenedor-botones">
                    <button class="boton-verificar" onclick="verificarActividad2()">‚úì Verificar Orden</button>
                    <button class="boton-reintentar" id="btn-reintentar-act2" onclick="reiniciarActividad2()">üîÑ Reintentar</button>
                </div>
            </div>

            <!-- ACTIVIDAD 3: CLASIFICAR CON BOTONES -->
            <div class="seccion-actividad" id="actividad-3">
                <div class="encabezado-actividad">
                    <h2>üìä Actividad 3: Clasifica las Estructuras</h2>
                    <span class="indicador-progreso">Actividad 3 de 4</span>
                </div>

                <p style="color: var(--azul-oscuro); margin-bottom: 20px; font-size: 16px;">
                    <strong>‚ö†Ô∏è DESAF√çO:</strong> Para cada estructura, haz clic en el sistema al que pertenece.
                </p>

                <div class="contenedor-clasificacion" id="contenedor-clasificacion">
                    <!-- Se llenar√°n din√°micamente -->
                </div>

                <div class="retroalimentacion" id="retroalimentacion-act3"></div>
                <div class="contenedor-botones">
                    <button class="boton-verificar" onclick="verificarActividad3()">‚úì Verificar Clasificaci√≥n</button>
                    <button class="boton-reintentar" id="btn-reintentar-act3" onclick="reiniciarActividad3()">üîÑ Reintentar</button>
                </div>
            </div>

            <!-- ACTIVIDAD 4: PREGUNTAS M√öLTIPLE -->
            <div class="seccion-actividad" id="actividad-4">
                <div class="encabezado-actividad">
                    <h2>‚ùì Actividad 4: Preguntas de Conocimiento</h2>
                    <span class="indicador-progreso">Actividad 4 de 4</span>
                </div>

                <div class="pregunta-completa">
                    <div class="pregunta-texto">‚ùì Pregunta 1: ¬øCu√°l es la funci√≥n principal de los PULMONES?</div>
                    <div class="contenedor-seleccion" id="pregunta-1">
                        <div class="opcion-seleccion" data-correcta="true" onclick="seleccionarOpcion(this, 'pregunta-1')">
                            <div>ü´Å Intercambiar ox√≠geno con el aire</div>
                        </div>
                        <div class="opcion-seleccion" data-correcta="false" onclick="seleccionarOpcion(this, 'pregunta-1')">
                            <div>‚ù§Ô∏è Bombear sangre al cuerpo</div>
                        </div>
                        <div class="opcion-seleccion" data-correcta="false" onclick="seleccionarOpcion(this, 'pregunta-1')">
                            <div>üß† Controlar movimientos</div>
                        </div>
                        <div class="opcion-seleccion" data-correcta="false" onclick="seleccionarOpcion(this, 'pregunta-1')">
                            <div>üçΩÔ∏è Procesar alimentos</div>
                        </div>
                    </div>
                </div>

                <div class="pregunta-completa">
                    <div class="pregunta-texto">‚ùì Pregunta 2: ¬øQu√© caracter√≠stica diferencia a los MAM√çFEROS de otros animales?</div>
                    <div class="contenedor-seleccion" id="pregunta-2">
                        <div class="opcion-seleccion" data-correcta="true" onclick="seleccionarOpcion(this, 'pregunta-2')">
                            <div>ü¶Å Sangre caliente y esqueleto interno</div>
                        </div>
                        <div class="opcion-seleccion" data-correcta="false" onclick="seleccionarOpcion(this, 'pregunta-2')">
                            <div>ü¶é Todos tienen escamas</div>
                        </div>
                        <div class="opcion-seleccion" data-correcta="false" onclick="seleccionarOpcion(this, 'pregunta-2')">
                            <div>ü¶Ö Todos tienen plumas</div>
                        </div>
                        <div class="opcion-seleccion" data-correcta="false" onclick="seleccionarOpcion(this, 'pregunta-2')">
                            <div>üê† Solo viven en el agua</div>
                        </div>
                    </div>
                </div>

                <div class="retroalimentacion" id="retroalimentacion-act4"></div>
                <div class="contenedor-botones">
                    <button class="boton-verificar" onclick="verificarActividad4()">‚úì Verificar Respuestas</button>
                </div>
            </div>

            <!-- SECCI√ìN RESULTADO -->
            <div class="seccion-resultado" id="seccion-resultado">
                <div class="tarjeta-resultado">
                    <div class="emoji-resultado" id="emoji-resultado">üéâ</div>
                    <h2>¬°Completaste el Quiz!</h2>
                    <div class="puntuacion-final" id="puntuacion-final">0/4</div>
                    <div id="mensaje-resultado" style="font-size: 18px;"></div>
                </div>

                <div class="detalles-resultado">
                    <h3 style="color: var(--naranja-vibrante); margin-bottom: 15px;">üìä Desglose de Puntuaci√≥n:</h3>
                    <div class="detalle-item">
                        <span>üîó Actividad 1: Relacionar</span>
                        <span id="detalle-act1" style="font-weight: 600;">0/1</span>
                    </div>
                    <div class="detalle-item">
                        <span>üî¢ Actividad 2: Ordenar</span>
                        <span id="detalle-act2" style="font-weight: 600;">0/1</span>
                    </div>
                    <div class="detalle-item">
                        <span>üìä Actividad 3: Clasificar</span>
                        <span id="detalle-act3" style="font-weight: 600;">0/1</span>
                    </div>
                    <div class="detalle-item">
                        <span>‚ùì Actividad 4: Preguntas</span>
                        <span id="detalle-act4" style="font-weight: 600;">0/1</span>
                    </div>
                    <div class="detalle-item" style="border-top: 2px solid var(--amarillo-dorado); padding-top: 15px; margin-top: 15px;">
                        <span style="font-size: 18px; font-weight: 700;">Puntuaci√≥n Total</span>
                        <span id="detalle-total" style="font-weight: 600; font-size: 18px;">0/4</span>
                    </div>
                </div>

                <div class="contenedor-botones">
                    <button class="boton-descargar" onclick="descargarPDF()">üì• Descargar PDF</button>
                    <button class="boton-mejorar" onclick="mejorarPuntaje()">üîÑ Intentar de Nuevo</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATOS GLOBALES
        let puntuaciones = { act1: 0, act2: 0, act3: 0, act4: 0 };
        let seleccionesAct4 = { 'pregunta-1': null, 'pregunta-2': null };
        let parejaEnProceso = null;
        let sortables = {};

        const sistemasYFunciones = [
            { sistema: 'esqueletico', nombre: 'ü¶¥ Sistema Esquel√©tico', funcion: 'Sostiene y protege √≥rganos' },
            { sistema: 'muscular', nombre: 'üí™ Sistema Muscular', funcion: 'Permite el movimiento' },
            { sistema: 'circulatorio', nombre: '‚ù§Ô∏è Sistema Circulatorio', funcion: 'Transporta ox√≠geno y nutrientes' },
            { sistema: 'respiratorio', nombre: 'ü´Å Sistema Respiratorio', funcion: 'Permite intercambiar gases' }
        ];

        const procesoDigestivo = [
            { orden: 1, texto: 'Masticas el alimento en la boca' },
            { orden: 2, texto: 'El alimento viaja por el es√≥fago' },
            { orden: 3, texto: 'El est√≥mago digiere el alimento' },
            { orden: 4, texto: 'Los intestinos absorben nutrientes' }
        ];

        const estructuras = [
            { tipo: 'esqueletico', nombre: 'ü¶¥ F√©mur' },
            { tipo: 'muscular', nombre: 'üí™ B√≠ceps' },
            { tipo: 'esqueletico', nombre: 'ü¶¥ V√©rtebra' },
            { tipo: 'muscular', nombre: 'ü¶µ Gemelos' },
            { tipo: 'esqueletico', nombre: 'ü¶¥ Costilla' },
            { tipo: 'muscular', nombre: 'üí™ Tr√≠ceps' }
        ];

        // NAVEGACI√ìN
        function irAlQuiz() {
            document.getElementById('seccion-inicio').classList.remove('activa');
            document.getElementById('seccion-datos').classList.add('activa');
            document.getElementById('fecha-quiz').valueAsDate = new Date();
        }

        function iniciarActividades() {
            const nombre = document.getElementById('nombre-estudiante').value;
            if (!nombre) {
                alert('Por favor ingresa tu nombre');
                return;
            }
            window.datosEstudiante = {
                nombre: nombre,
                grado: document.getElementById('grado-estudiante').value,
                fecha: document.getElementById('fecha-quiz').value
            };
            document.getElementById('seccion-datos').classList.remove('activa');
            irAActividad(1);
        }

        function irAActividad(num) {
            document.querySelectorAll('.seccion-actividad').forEach(s => s.classList.remove('activa'));
            
            if (num === 1) inicializarActividad1();
            if (num === 2) inicializarActividad2();
            if (num === 3) inicializarActividad3();
            
            document.getElementById(`actividad-${num}`).classList.add('activa');
            window.scrollTo(0, 0);
        }

        // ACTIVIDAD 1
        function inicializarActividad1() {
            document.getElementById('btn-reintentar-act1').classList.remove('mostrar');
            let sistemas = [...sistemasYFunciones].sort(() => Math.random() - 0.5);
            let funciones = [...sistemasYFunciones].sort(() => Math.random() - 0.5);

            document.getElementById('sistemas-desordenados').innerHTML = '';
            document.getElementById('funciones-desordenadas').innerHTML = '';
            parejaEnProceso = null;

            sistemas.forEach(s => {
                const div = document.createElement('div');
                div.className = 'item-par';
                div.setAttribute('data-sistema', s.sistema);
                div.textContent = s.nombre;
                div.onclick = () => seleccionarParAct1(div);
                document.getElementById('sistemas-desordenados').appendChild(div);
            });

            funciones.forEach(f => {
                const div = document.createElement('div');
                div.className = 'item-par';
                div.setAttribute('data-sistema', f.sistema);
                div.textContent = f.funcion;
                div.onclick = () => seleccionarParAct1(div);
                document.getElementById('funciones-desordenadas').appendChild(div);
            });
        }

        function seleccionarParAct1(elemento) {
            if (elemento.classList.contains('correcto')) return;

            if (parejaEnProceso === null) {
                parejaEnProceso = elemento;
                elemento.classList.add('seleccionado');
            } else if (parejaEnProceso === elemento) {
                elemento.classList.remove('seleccionado');
                parejaEnProceso = null;
            } else if (parejaEnProceso.getAttribute('data-sistema') === elemento.getAttribute('data-sistema')) {
                parejaEnProceso.classList.add('correcto');
                elemento.classList.add('correcto');
                parejaEnProceso.classList.remove('seleccionado');
                parejaEnProceso = null;
            } else {
                parejaEnProceso.classList.remove('seleccionado');
                parejaEnProceso = elemento;
                elemento.classList.add('seleccionado');
            }
        }

        function verificarActividad1() {
            const correctos = document.querySelectorAll('#actividad-1 .item-par.correcto').length;
            if (correctos === 8) {
                puntuaciones.act1 = 1;
                mostrarRetroalimentacion('retroalimentacion-act1', 'correcto', '‚úÖ ¬°Perfecto! Relacionaste correctamente todos los sistemas.');
                document.getElementById('btn-reintentar-act1').classList.remove('mostrar');
                setTimeout(() => irAActividad(2), 1500);
            } else {
                mostrarRetroalimentacion('retroalimentacion-act1', 'incorrecto', `‚ùå Has acertado ${correctos}/8 pares. Intenta de nuevo.`);
                document.getElementById('btn-reintentar-act1').classList.add('mostrar');
            }
        }

        function reiniciarActividad1() {
            document.getElementById('retroalimentacion-act1').classList.remove('mostrar');
            inicializarActividad1();
        }

        // ACTIVIDAD 2 - NUEVO SISTEMA CON SELECTS
        function inicializarActividad2() {
            document.getElementById('btn-reintentar-act2').classList.remove('mostrar');
            const contenedor = document.getElementById('contenedor-orden-selects');
            contenedor.innerHTML = '';

            // Crear 4 selects, uno para cada posici√≥n
            for (let posicion = 1; posicion <= 4; posicion++) {
                const div = document.createElement('div');
                div.className = 'item-select-orden';
                
                const label = document.createElement('label');
                label.textContent = `Paso ${posicion}:`;
                
                const select = document.createElement('select');
                select.id = `select-paso-${posicion}`;
                select.setAttribute('data-posicion', posicion);
                
                const opcionDefault = document.createElement('option');
                opcionDefault.value = '';
                opcionDefault.textContent = '-- Selecciona un paso --';
                select.appendChild(opcionDefault);
                
                // Agregar opciones con los pasos desordenados
                let pasosMezclados = [...procesoDigestivo].sort(() => Math.random() - 0.5);
                pasosMezclados.forEach(paso => {
                    const option = document.createElement('option');
                    option.value = paso.orden;
                    option.textContent = paso.texto;
                    select.appendChild(option);
                });
                
                div.appendChild(label);
                div.appendChild(select);
                contenedor.appendChild(div);
            }
        }

        function verificarActividad2() {
            let correcto = true;
            let seleccionados = 0;

            for (let posicion = 1; posicion <= 4; posicion++) {
                const select = document.getElementById(`select-paso-${posicion}`);
                const valor = select.value;
                
                if (valor === '') {
                    correcto = false;
                } else if (parseInt(valor) !== posicion) {
                    correcto = false;
                    select.style.borderColor = 'var(--rojo-error)';
                } else {
                    select.style.borderColor = 'var(--verde-exito)';
                    seleccionados++;
                }
            }

            if (seleccionados < 4) {
                mostrarRetroalimentacion('retroalimentacion-act2', 'incorrecto', `‚ùå Debes seleccionar todos los pasos. Has completado ${seleccionados}/4.`);
                document.getElementById('btn-reintentar-act2').classList.add('mostrar');
            } else if (correcto) {
                puntuaciones.act2 = 1;
                mostrarRetroalimentacion('retroalimentacion-act2', 'correcto', '‚úÖ ¬°Excelente! Ordenaste correctamente el proceso digestivo.');
                document.getElementById('btn-reintentar-act2').classList.remove('mostrar');
                setTimeout(() => irAActividad(3), 1500);
            } else {
                mostrarRetroalimentacion('retroalimentacion-act2', 'incorrecto', '‚ùå El orden no es correcto. Revisa e intenta de nuevo.');
                document.getElementById('btn-reintentar-act2').classList.add('mostrar');
            }
        }

        function reiniciarActividad2() {
            document.getElementById('retroalimentacion-act2').classList.remove('mostrar');
            // Limpiar estilos
            for (let posicion = 1; posicion <= 4; posicion++) {
                const select = document.getElementById(`select-paso-${posicion}`);
                if (select) {
                    select.style.borderColor = '';
                }
            }
            inicializarActividad2();
        }

        // ACTIVIDAD 3 - NUEVO SISTEMA CON BOTONES
        let clasificacionesAct3 = {};

        function inicializarActividad3() {
            document.getElementById('btn-reintentar-act3').classList.remove('mostrar');
            clasificacionesAct3 = {};
            
            const contenedor = document.getElementById('contenedor-clasificacion');
            contenedor.innerHTML = '';

            // Mezclar estructuras
            let estructurasMezcladas = [...estructuras].sort(() => Math.random() - 0.5);

            estructurasMezcladas.forEach((est, idx) => {
                const div = document.createElement('div');
                div.className = 'item-clasificacion';
                
                const nombre = document.createElement('div');
                nombre.className = 'nombre-estructura';
                nombre.textContent = est.nombre;
                
                const botonesDiv = document.createElement('div');
                botonesDiv.className = 'botones-clasificacion';
                
                const btnEsqueletico = document.createElement('button');
                btnEsqueletico.className = 'boton-clasificar';
                btnEsqueletico.textContent = 'ü¶¥ Sistema Esquel√©tico';
                btnEsqueletico.onclick = () => seleccionarClasificacion(idx, 'esqueletico', btnEsqueletico, btnMuscular);
                btnEsqueletico.id = `btn-esq-${idx}`;
                
                const btnMuscular = document.createElement('button');
                btnMuscular.className = 'boton-clasificar';
                btnMuscular.textContent = 'üí™ Sistema Muscular';
                btnMuscular.onclick = () => seleccionarClasificacion(idx, 'muscular', btnMuscular, btnEsqueletico);
                btnMuscular.id = `btn-mus-${idx}`;
                
                botonesDiv.appendChild(btnEsqueletico);
                botonesDiv.appendChild(btnMuscular);
                
                div.appendChild(nombre);
                div.appendChild(botonesDiv);
                contenedor.appendChild(div);
                
                // Guardar el √≠ndice para verificaci√≥n
                clasificacionesAct3[idx] = { tipo: est.tipo, esq: btnEsqueletico, mus: btnMuscular };
            });
        }

        function seleccionarClasificacion(idx, tipo, btnSeleccionado, btnOtro) {
            // Deseleccionar el otro bot√≥n
            btnOtro.classList.remove('seleccionado');
            
            // Seleccionar el bot√≥n actual
            if (btnSeleccionado.classList.contains('seleccionado')) {
                btnSeleccionado.classList.remove('seleccionado');
                delete clasificacionesAct3[idx].seleccion;
            } else {
                btnSeleccionado.classList.add('seleccionado');
                clasificacionesAct3[idx].seleccion = tipo;
            }
        }

        function verificarActividad3() {
            let correctas = 0;
            let completadas = 0;

            for (let idx in clasificacionesAct3) {
                const item = clasificacionesAct3[idx];
                const btnEsq = item.esq;
                const btnMus = item.mus;
                
                // Limpiar estilos anteriores
                btnEsq.classList.remove('correcto', 'incorrecto');
                btnMus.classList.remove('correcto', 'incorrecto');

                if (item.seleccion) {
                    completadas++;
                    
                    if (item.seleccion === item.tipo) {
                        correctas++;
                        if (item.seleccion === 'esqueletico') {
                            btnEsq.classList.add('correcto');
                        } else {
                            btnMus.classList.add('correcto');
                        }
                    } else {
                        if (item.seleccion === 'esqueletico') {
                            btnEsq.classList.add('incorrecto');
                            btnMus.classList.add('correcto');
                        } else {
                            btnMus.classList.add('incorrecto');
                            btnEsq.classList.add('correcto');
                        }
                    }
                }
            }

            if (completadas < 6) {
                mostrarRetroalimentacion('retroalimentacion-act3', 'incorrecto', `‚ùå Debes clasificar todas las estructuras. Has completado ${completadas}/6.`);
                document.getElementById('btn-reintentar-act3').classList.add('mostrar');
            } else if (correctas === 6) {
                puntuaciones.act3 = 1;
                mostrarRetroalimentacion('retroalimentacion-act3', 'correcto', '‚úÖ ¬°Correcto! Clasificaste todas las estructuras correctamente.');
                document.getElementById('btn-reintentar-act3').classList.remove('mostrar');
                setTimeout(() => irAActividad(4), 1500);
            } else {
                mostrarRetroalimentacion('retroalimentacion-act3', 'incorrecto', `‚ùå Has clasificado ${correctas}/6 correctamente. Revisa e intenta de nuevo.`);
                document.getElementById('btn-reintentar-act3').classList.add('mostrar');
            }
        }

        function reiniciarActividad3() {
            document.getElementById('retroalimentacion-act3').classList.remove('mostrar');
            inicializarActividad3();
        }

        // ACTIVIDAD 4
        function seleccionarOpcion(elemento, pregunta) {
            document.querySelectorAll(`#${pregunta} .opcion-seleccion`).forEach(op => op.classList.remove('seleccionada'));
            elemento.classList.add('seleccionada');
            seleccionesAct4[pregunta] = elemento.getAttribute('data-correcta') === 'true';
        }

        function verificarActividad4() {
            let correctas = 0;
            for (let pregunta in seleccionesAct4) {
                if (seleccionesAct4[pregunta] === true) correctas++;
            }

            if (correctas === 2) {
                puntuaciones.act4 = 1;
                mostrarRetroalimentacion('retroalimentacion-act4', 'correcto', '‚úÖ ¬°Excelente! Respondiste correctamente.');
            } else {
                mostrarRetroalimentacion('retroalimentacion-act4', 'incorrecto', `‚ùå Respondiste ${correctas}/2 correctamente. Revisa tus respuestas.`);
            }

            setTimeout(() => mostrarResultado(), 1500);
        }

        // RESULTADO
        function mostrarResultado() {
            const total = Object.values(puntuaciones).reduce((a, b) => a + b, 0);
            document.querySelectorAll('.seccion-actividad').forEach(s => s.classList.remove('activa'));
            document.getElementById('seccion-resultado').classList.add('activa');

            document.getElementById('puntuacion-final').textContent = `${total}/4`;
            document.getElementById('detalle-act1').textContent = `${puntuaciones.act1}/1`;
            document.getElementById('detalle-act2').textContent = `${puntuaciones.act2}/1`;
            document.getElementById('detalle-act3').textContent = `${puntuaciones.act3}/1`;
            document.getElementById('detalle-act4').textContent = `${puntuaciones.act4}/1`;
            document.getElementById('detalle-total').textContent = `${total}/4`;

            let mensaje = '';
            let emoji = '';
            if (total === 4) {
                mensaje = '¬°PERFECTO! Eres un experto en anatom√≠a.';
                emoji = 'üèÜ';
            } else if (total === 3) {
                mensaje = '¬°EXCELENTE! Dominaste la mayor√≠a de los temas.';
                emoji = '‚≠ê';
            } else if (total === 2) {
                mensaje = '¬°BUEN ESFUERZO! Tienes buenas bases.';
                emoji = 'üëç';
            } else {
                mensaje = '¬°SIGUE PRACTICANDO! Puedes mejorar.';
                emoji = 'üí™';
            }

            document.getElementById('mensaje-resultado').textContent = mensaje;
            document.getElementById('emoji-resultado').textContent = emoji;

            window.scrollTo(0, 0);
        }

        // UTILIDADES
        function mostrarRetroalimentacion(id, tipo, mensaje) {
            const elem = document.getElementById(id);
            elem.className = `retroalimentacion mostrar ${tipo}`;
            elem.textContent = mensaje;
        }

        function mejorarPuntaje() {
            puntuaciones = { act1: 0, act2: 0, act3: 0, act4: 0 };
            seleccionesAct4 = { 'pregunta-1': null, 'pregunta-2': null };
            document.getElementById('seccion-resultado').classList.remove('activa');
            irAActividad(1);
        }

        function descargarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const total = Object.values(puntuaciones).reduce((a, b) => a + b, 0);

            doc.setFont(undefined, 'bold');
            doc.setFontSize(20);
            doc.text('REPORTE DE EVALUACI√ìN', 105, 20, { align: 'center' });

            doc.setFont(undefined, 'normal');
            doc.setFontSize(12);
            doc.text('Quiz: Anatom√≠a de Mam√≠feros', 105, 35, { align: 'center' });

            doc.setFontSize(11);
            doc.text(`Estudiante: ${window.datosEstudiante.nombre}`, 20, 50);
            doc.text(`Grado: ${window.datosEstudiante.grado}`, 20, 60);
            doc.text(`Fecha: ${window.datosEstudiante.fecha}`, 20, 70);

            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text(`PUNTUACI√ìN: ${total}/4`, 105, 90, { align: 'center' });

            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            let yPos = 110;
            doc.text('Actividad 1 (Relacionar):', 20, yPos);
            doc.text(`${puntuaciones.act1}/1`, 150, yPos);
            yPos += 10;

            doc.text('Actividad 2 (Ordenar):', 20, yPos);
            doc.text(`${puntuaciones.act2}/1`, 150, yPos);
            yPos += 10;

            doc.text('Actividad 3 (Clasificar):', 20, yPos);
            doc.text(`${puntuaciones.act3}/1`, 150, yPos);
            yPos += 10;

            doc.text('Actividad 4 (Preguntas):', 20, yPos);
            doc.text(`${puntuaciones.act4}/1`, 150, yPos);

            doc.save(`Quiz_Anatomia_${window.datosEstudiante.nombre}.pdf`);
        }
    </script>
</body>
</html>
